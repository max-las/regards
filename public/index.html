<!DOCTYPE html>
<html lang="fr">
<head>
	<script>
		const assets = {
			characters: [
				"andre.png",
				"camille.png",
				"leo.png"
			],
			pictures: [
				"children.jpg",
				"christ.png",
				"framed.png",
				"museum_inside.jpg"
			],
			other: [
				"/global.css",
				"/build/bundle.css",
				"/build/bundle.js"
			]
		};
		let assetsCount = assets.characters.length + assets.pictures.length + assets.other.length;
		let assetsLoaded = 0;
		let percent = 0;
		function runPreloadProgress(){
			for (const picFile of assets.pictures) {
				preloadWithProgress(`/img/pictures/${picFile}`);
			}
			for (const iconFile of assets.characters) {
				preloadWithProgress(`/img/characters/${iconFile}`);
			}
			for (const otherFile of assets.other) {
				preloadWithProgress(otherFile);
			}
		}
		function preloadWithProgress(url){
			let xhr = new XMLHttpRequest();
			let previousLoad = 0;
			xhr.onprogress = (e) => {
				const newLoad = e.loaded / e.total;
				assetsLoaded += newLoad - previousLoad;
				previousLoad = newLoad;
				updatePercent();
			};
			xhr.onload = () => {
				if(xhr.status >= 400){
					assetsLoaded += 1 - previousLoad;
					updatePercent();
				}
			}
			xhr.open("GET", url, true);
			xhr.send();
		}
		function updatePercent(){
			percent = (assetsLoaded / assetsCount) * 100;
			if(percent >= 99.99){
				document.querySelector(".preloadProgress").classList.add("hidden");
				document.querySelector("#svelte").classList.remove("hidden");
			}else{
				document.querySelector(".preloadProgress p").innerHTML = `${Math.floor(percent)}%`;
			}
		}
	</script>

	<meta charset='utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1'>

	<title>Svelte app</title>

	<link rel='icon' type='image/png' href='/favicon.png'>
	<link rel='stylesheet' href='/global.css'>
	<link rel='stylesheet' href='/build/bundle.css'>

	<script defer src='/build/bundle.js'></script>

	<style>
		.preloadProgress {
			width: 100vw;
			height: 100vh;
			background-color: black;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.preloadProgress p {
			color: white;
			font-size: 40px;
		}

		.hidden {
			display: none;
		}
	</style>
</head>
<body>
	<div class="preloadProgress">
		<p>0%</p>
	</div>

	<div id="svelte" class="hidden"></div>
	<script>runPreloadProgress();</script>
</body>
</html>
